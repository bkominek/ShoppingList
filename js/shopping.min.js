var totalPrice=0;var itemID=0;var globalTax=13;var totalTax=0;var store="";var shoppingID=0;var backPage="home";function onBackKeyDown(){if(backPage=="confirm"){setConfirmBox()}else{$.mobile.changePage("#"+backPage)}}function setAbout(){$.mobile.changePage("#about");backPage="home"}function onDeviceReady(){document.addEventListener("backbutton",onBackKeyDown,false);$("#add").bind("pageshow",function(){backPage="calculator"});$("#compare").bind("pageshow",function(){backPage="calculator"});$("#calculator").bind("pageshow",function(){backPage="home"});$("#compare2items").bind("pageshow",function(){backPage="home"});$("#createList").bind("pageshow",function(){backPage="confirm"});$("#storeOverlay").hide();$("#overlay").hide();$("#deleteOverlay").hide()}function addButton(){$.mobile.changePage("#add");items=$(".selectName");if(items.length>0){for(i=0;i<items.length;i++){items[i].className="singleItem";items[i].removeAttribute("onclick");deleteButtons[i].setAttribute("style","z-index:2")}}backPage="calculator"}function cancel(){$.mobile.changePage("#calculator");document.getElementById("namefield").value="";document.getElementById("pricefield").value="";document.getElementById("discountfield").value=""}function removeNoTax(a){price=document.getElementById("price"+a).innerHTML;totalPrice-=parseFloat(price);if(totalPrice<0){totalPrice=0}document.getElementById("total").innerHTML="$"+totalPrice.toFixed(2);removeItem("product"+a);if($(".singleItem").length==0){$("#compareButton").hide()}}function remove(a){price=document.getElementById("price"+a).innerHTML;if(totalPrice<0){totalPrice=0}tax=price*(globalTax/100);totalTax-=tax;totalPrice-=parseFloat(price)+parseFloat(tax);document.getElementById("total").innerHTML="$"+totalPrice.toFixed(2);document.getElementById("tax").innerHTML=totalTax.toFixed(2);removeItem("product"+a);if($(".singleItem").length==0){$("#compareButton").hide()}}function submit(){price=document.getElementById("pricefield");if(price.value.length<1){alert("Price must be filled out");return}price.value=price.value.replace("$","");discount=document.getElementById("discountfield");if(discount.value>0){var b=document.getElementById("discountType");var a=b.options[b.selectedIndex].value;if(a=="percent"){discount.value=discount.value/100;price.value=price.value*(1-discount.value)}else{price.value-=discount.value}}if(document.getElementById("noTax").checked==false){addTax(price.value)}else{addNoTax(price.value)}price.value=parseFloat(price.value).toFixed(2);newDelete=document.createElement("a");newDelete.setAttribute("data-role","button");newDelete.setAttribute("data-icon","delete");newDelete.setAttribute("data-iconpos","notext");newDelete.setAttribute("class","delete ui-btn ui-btn-up-a ui-shadow ui-btn-corner-all ui-btn-icon-notext");newDelete.setAttribute("data-corners","true");newDelete.setAttribute("data-shadow","true");newDelete.setAttribute("data-iconshadow","true");newDelete.setAttribute("data-wrapperels","span");newDelete.setAttribute("title","");if(document.getElementById("noTax").checked==false){newDelete.setAttribute("onclick","remove('"+itemID+"')")}else{newDelete.setAttribute("onclick","removeNoTax('"+itemID+"')")}newSpan=document.createElement("span");newSpan.setAttribute("class","ui-icon ui-icon-delete ui-icon-shadow");newSpan.innerHTML="&nbsp;";spanContainer=document.createElement("span");spanContainer.setAttribute("class","ui-btn-inner io-btn-corner-all");spanContainer.appendChild(newSpan);blankSpan=document.createElement("span");blankSpan.setAttribute("class","ui-btn-text");newDelete.appendChild(spanContainer);newItem=document.createElement("div");newItem.setAttribute("id","product"+itemID);newItem.setAttribute("class","singleItem");newName=document.createElement("div");newName.setAttribute("class","name");newPrice=document.createElement("div");if(document.getElementById("noTax").checked==false){newPrice.setAttribute("class","hasTax fullPrice")}else{newPrice.setAttribute("class","noTax fullPrice")}newPrice.setAttribute("id","price"+itemID);newPrice.innerHTML=parseFloat(price.value).toFixed(2);itemID+=1;nameDiv=document.createElement("div");nameDiv.setAttribute("style","margin-top:-45px;margin-left:40px;");nameDiv.setAttribute("class","itemName");nameDiv.innerHTML=document.getElementById("namefield").value;newName.appendChild(newDelete);newName.appendChild(nameDiv);newItem.appendChild(newName);newItem.appendChild(newPrice);container=document.getElementById("itemsContainer");container.appendChild(newItem);$("#compareButton").show();$.mobile.changePage("#calculator");document.getElementById("namefield").value="";price.value="";discount.value=""}function addTax(a){tax=a*(globalTax/100);totalTax+=tax;totalPrice+=parseFloat(a)+parseFloat(tax);document.getElementById("total").innerHTML="$"+totalPrice.toFixed(2);document.getElementById("tax").innerHTML=totalTax.toFixed(2)}function addNoTax(a){totalPrice+=parseFloat(a);document.getElementById("total").innerHTML="$"+totalPrice.toFixed(2)}function toggleTax(){allPrices=$(".hasTax");totalPrice=0;for(i=0;i<allPrices.length;i++){totalPrice+=parseFloat(allPrices[i].innerHTML)}globalTax=document.getElementById("editTax").value;totalTax=totalPrice*(globalTax/100);totalPrice+=totalTax;allPricesNoTax=$(".noTax");for(i=0;i<allPricesNoTax.length;i++){totalPrice+=parseFloat(allPricesNoTax[i].innerHTML)}document.getElementById("total").innerHTML="$"+totalPrice.toFixed(2);document.getElementById("tax").innerHTML=totalTax.toFixed(2)}function updateStore(){store=document.getElementById("location").value;document.getElementById("storeLocation").innerHTML=store;store=store.toLowerCase();store=store.replace(/\s/g,"+");cancelStoreUpdate()}function googleSearch(e,b,d,c,a){backPage=a;clearDiv("itemList");b=b.toLowerCase();e=e.replace(/\s/g,"+");if(b.length>0){e=e+"+"+b}$.mobile.showPageLoadingMsg("a","loading...");$.ajax({type:"GET",url:"https://www.googleapis.com/shopping/search/v1/public/products?key=AIzaSyC9OEeuM4-CSogXbDRn7osgGBnyZUvx_AI&country=US&q="+e+"&alt=json",data:"{}",dataType:"jsonp",success:function(f){console.log(f);if(f.totalItems>0){displayItems(f.items,b,d,c)}else{$.mobile.hidePageLoadingMsg();alert("No items found")}},error:function(f){$.mobile.hidePageLoadingMsg();alert("Error: "+f)}})}function displayItems(a,b,d,c){$.mobile.changePage("#displayItems");list=$("#itemList");for(i=0;i<a.length;i++){comLocation=a[i].product.link.indexOf(".com");if(comLocation==-1){comLocation=a[i].product.link.indexOf(".net")}if(comLocation==-1){comLocation=a[i].product.link.indexOf(".ca")}if(comLocation==-1){comLocation=a[i].product.link.indexOf(".org")}firstDot=a[i].product.link.indexOf(".");if(firstDot<comLocation){itemLocation=a[i].product.link.substring(firstDot+1,comLocation)}else{itemLocation=a[i].product.link.substring(7,comLocation)}if(c=="all"||b==itemLocation){list.append($("<li onclick='"+d+"("+i+")'>").data("theme","a").append($("<a>").append($("<div id='item"+i+"'>").append("<div class='listName'>"+a[i].product.title+"</div><div class='listPrice'>$"+a[i].product.inventories[0].price+"</div><br /><div class='itemLocation'>"+itemLocation+"</div><div class='link'>"+a[i].product.link+"</div>"))))}}list.listview("refresh")}function getCoordinates(){$.mobile.showPageLoadingMsg("a","loading...");options={enableHighAccuracy:true,timeout:60000,maximumAge:0};navigator.geolocation.getCurrentPosition(getStoreName,a,options);function a(b){}}function getStoreName(c){var a=new google.maps.LatLng(c.coords.latitude,c.coords.longitude);map=new google.maps.Map(document.getElementById("map"),{center:a,zoom:15});var b={location:a,radius:"500",rankby:"DISTANCE",types:["store","bicycle_store","book_store","casino","clothing_store","convenience_store","department_store","electronics_store","grocery_or_supermarket","hardware_store","home_goods_store","jewelry_store","liquor_store","pet_store","shopping_mall"]};service=new google.maps.places.PlacesService(map);service.search(b,d);function d(f,e){document.getElementById("storeLocation").innerHTML=f[0].name;cancelStoreUpdate();$.mobile.hidePageLoadingMsg()}}function selectItem(a){item=document.getElementById("item"+a);document.getElementById("namefield").value=item.getElementsByClassName("listName")[0].innerHTML;document.getElementById("pricefield").value=item.getElementsByClassName("listPrice")[0].innerHTML;$.mobile.changePage("#add")}function toggleCompare(){items=$(".singleItem");deleteButtons=$(".delete");if(items.length>0){for(i=0;i<items.length;i++){items[i].className="selectName";items[i].setAttribute("onclick","compare('"+items[i].id+"')");deleteButtons[i].setAttribute("style","z-index:-3")}}else{items=$(".selectName");if(items.length>0){for(i=0;i<items.length;i++){items[i].className="singleItem";items[i].removeAttribute("onclick");deleteButtons[i].setAttribute("style","z-index:2")}}}}function compare(a){$.mobile.changePage("#compare");items=$(".selectName");deleteButtons=$(".delete");if(items.length>0){for(i=0;i<items.length;i++){items[i].className="singleItem";items[i].setAttribute("onclick","");deleteButtons[i].setAttribute("style","z-index:2")}}item=document.getElementById(a);document.getElementById("compareName1").innerHTML=item.getElementsByClassName("itemName")[0].innerHTML;document.getElementById("comparePrice1").innerHTML="$"+item.getElementsByClassName("fullPrice")[0].innerHTML;document.getElementById("compareLocation1").innerHTML=store}function compareItem(a){$.mobile.changePage("#compareItems");item=document.getElementById("item"+a);console.log(a);console.log(item);price1=document.getElementById("comparePrice1").innerHTML;price2=item.getElementsByClassName("listPrice")[0].innerHTML;price1=price1.replace("$","");price2=price2.replace("$","");document.getElementById("finalName1").innerHTML=document.getElementById("compareName1").innerHTML;document.getElementById("finalPrice1").innerHTML="$"+price1;if(store.length>0){document.getElementById("finalLocation1").innerHTML=store}else{document.getElementById("finalLocation1").innerHTML="&nbsp;"}document.getElementById("finalName2").innerHTML=item.getElementsByClassName("listName")[0].innerHTML;document.getElementById("finalPrice2").innerHTML="$"+price2;document.getElementById("finalLocation2").innerHTML=item.getElementsByClassName("itemLocation")[0].innerHTML;document.getElementById("itemLink").setAttribute("onclick","openLinkInBrowser(item.getElementsByClassName('link')[0].innerHTML)");difference=parseFloat(price1)-parseFloat(price2);document.getElementById("difference").innerHTML="$"+difference.toFixed(2);clearDiv("itemList")}function addToQuickList(){item=document.getElementById("newItemInput");if(item.value!=""){addItem(item.value);item.value=""}}function addItem(a){$("<div class='newitem' id='shopping"+shoppingID+"'><div class='itemText'>"+a+"</div></div>").hide().appendTo("#newItems").fadeIn(1000);newDelete=document.createElement("a");newDelete.setAttribute("data-role","button");newDelete.setAttribute("data-icon","delete");newDelete.setAttribute("data-iconpos","notext");newDelete.setAttribute("class","removeButton ui-btn ui-btn-up-a ui-shadow ui-btn-corner-all ui-btn-icon-notext");newDelete.setAttribute("data-corners","true");newDelete.setAttribute("data-shadow","true");newDelete.setAttribute("data-iconshadow","true");newDelete.setAttribute("data-wrapperels","span");newDelete.setAttribute("title","");newDelete.setAttribute("onclick","");newSpan=document.createElement("span");newSpan.setAttribute("class","ui-icon ui-icon-delete ui-icon-shadow");newSpan.innerHTML="&nbsp;";spanContainer=document.createElement("span");spanContainer.setAttribute("class","ui-btn-inner io-btn-corner-all");spanContainer.appendChild(newSpan);blankSpan=document.createElement("span");blankSpan.setAttribute("class","ui-btn-text");newDelete.appendChild(spanContainer);parent=document.getElementById("shopping"+shoppingID);parent.insertBefore(newDelete,parent.firstChild);removeButtons=$(".removeButton");removeButtons.hide();items=$(".setRemove");if(items.length>0){for(i=0;i<items.length;i++){items[i].className="newitem"}}$("#shopping"+shoppingID).bind("swiperight",function(b){b.delegateTarget.lastChild.setAttribute("style","text-decoration:line-through")}).bind("swipeleft",function(b){b.delegateTarget.lastChild.setAttribute("style","text-decoration:none")});shoppingID+=1}function toggleRemove(){items=$(".newitem");removeButtons=$(".removeButton");if(items.length>0){for(i=0;i<items.length;i++){items[i].className="setRemove";items[i].setAttribute("onclick","removeItem('"+items[i].id+"')")}removeButtons.show()}else{items=$(".setRemove");if(items.length>0){for(i=0;i<items.length;i++){items[i].className="newitem";items[i].removeAttribute("onclick")}}removeButtons.hide()}}function removeItem(a){$("#"+a).fadeOut(1000,function(){$(this).remove()})}function setSaveBox(){$("#overlay").show();document.getElementById("fileContainer").setAttribute("style","margin-left:-125px")}function setStoreBox(){$("#storeOverlay").show();document.getElementById("storeContainer").setAttribute("style","margin-left:-125px")}function cancelStoreUpdate(){$("#storeOverlay").hide();document.getElementById("location").value="";document.getElementById("storeContainer").setAttribute("style","margin-left:-9999px")}function save(){file=document.getElementById("saveAsName").value;if(localStorage.getItem("filenames")==null){var a=[];a[0]=file;localStorage.setItem("filenames",JSON.stringify(a))}else{fileNames=JSON.parse(localStorage.getItem("filenames"));fileNames[fileNames.length]=file;localStorage.setItem("filenames",JSON.stringify(fileNames))}items=$(".itemText");text="";for(i=0;i<items.length;i++){text+=items[i].innerHTML;if(i!=items.length-1){text+=","}}localStorage.setItem(file,text);cancelSave();alert("List saved!")}function readFileNames(a){clearDiv("newItems");clearDiv("savedList");files=localStorage.getItem("filenames");if(files==null){$.mobile.changePage("#"+a);if(a=="createList"){}}else{if(files.length==2){$.mobile.changePage("#"+a);if(a=="createList"){}}else{backPage="home";$.mobile.changePage("#displayLists");fileNames=JSON.parse(files);list=$("#savedList");for(i=(fileNames.length-1);i>-1;i--){list.append($("<div id='saved"+i+"' class='savedItem'><div class='deleteClickHelper' onclick='setDeleteListBox(this.parentNode.id, \""+fileNames[i]+"\")'><a data-role='button' data-icon='delete' data-iconpos='notext' class='delete ui-btn ui-btn-up-a ui-shadow ui-btn-corner-all ui-btn-icon-notext ui-btn-up-undefined' data-corners='true' data-shadow='true' data-iconshadow='true' data-wrapperels='span' style='z-index:5;float:left;position:relative;top:2px;margin-left:10px' ><span class='ui-btn-inner io-btn-corner-all'><span class='ui-icon ui-icon-delete ui-icon-shadow'>&nbsp;</span></span></a></div><div class='textContainer' onclick='read(\""+fileNames[i]+"\")'><div style='position:relative;top:12px'>"+fileNames[i]+"</div></div></div>"))}}}}function read(a){text=localStorage.getItem(a);result=text.split(",");for(i=0;i<result.length;i++){addItem(result[i])}$.mobile.changePage("#createList")}function removeByValue(c){var f,d=arguments,b=d.length,e;while(b>1&&c.length){f=d[--b];while((e=c.indexOf(f))!=-1){c.splice(e,1)}}return c}function setDeleteListBox(b,a){$("#deleteOverlay").show();document.getElementById("confirmDelete").setAttribute("style","margin-left:-125px");document.getElementById("deleteListButton").setAttribute("onclick","deleteList('"+b+"','"+a+"')")}function cancelDeleteList(){$("#deleteOverlay").hide();document.getElementById("confirmDelete").setAttribute("style","margin-left:-9999px")}function deleteList(b,a){filenames=JSON.parse(localStorage.getItem("filenames"));filenames=removeByValue(filenames,a);localStorage.setItem("filenames",JSON.stringify(filenames));localStorage.removeItem(a);cancelDeleteList();$("#"+b).fadeOut(1000)}function clearDiv(a){itemList=document.getElementById(a);while(itemList.hasChildNodes()){itemList.removeChild(itemList.lastChild)}}function cancelSave(){$("#overlay").hide();document.getElementById("saveAsName").value="";document.getElementById("fileContainer").setAttribute("style","margin-left:-9999px")}function searchItem1(){query=document.getElementById("itemSearchName").value;storeName=document.getElementById("item1SearchLocation").value;filter="all";functionName="fillItem1";backLocation="compare2items";googleSearch(query,storeName,functionName,filter,backLocation)}function fillItem1(a){item=document.getElementById("item"+a);document.getElementById("item1Name").innerHTML=item.getElementsByClassName("listName")[0].innerHTML;document.getElementById("item1Price").innerHTML=item.getElementsByClassName("listPrice")[0].innerHTML;document.getElementById("item1Location").innerHTML=item.getElementsByClassName("itemLocation")[0].innerHTML;document.getElementById("item1Link").setAttribute("onclick","openLinkInBrowser(item.getElementsByClassName('link')[0].innerHTML)");document.getElementById("itemSearchName").value=item.getElementsByClassName("listName")[0].innerHTML;clearDiv("itemList");$("#search1").hide();$("#search2").show();document.getElementById("item1contents").setAttribute("style","margin-left:0");$("#item1contents").show();$.mobile.changePage("#compare2items")}function searchItem2(){query=document.getElementById("itemSearchName").value;storeName=document.getElementById("item2SearchLocation").value;filter="all";functionName="fillItem2";backLocation="compare2items";googleSearch(query,storeName,functionName,filter,backLocation)}function fillItem2(a){item=document.getElementById("item"+a);document.getElementById("item2Name").innerHTML=item.getElementsByClassName("listName")[0].innerHTML;document.getElementById("item2Price").innerHTML=item.getElementsByClassName("listPrice")[0].innerHTML;document.getElementById("item2Location").innerHTML=item.getElementsByClassName("itemLocation")[0].innerHTML;document.getElementById("item2Link").setAttribute("onclick","openLinkInBrowser(item.getElementsByClassName('link')[0].innerHTML)");clearDiv("itemList");$("#search2").hide();document.getElementById("item2contents").setAttribute("style","margin-left:0");$("#item2contents").show();$.mobile.changePage("#compare2items")}function resetCompare(){document.getElementById("itemSearchName").value="";document.getElementById("item1SearchLocation").value="";document.getElementById("item2SearchLocation").value="";$("#item1contents").hide();$("#item2contents").hide();$("#search1").show();$("#search2").hide()}function setConfirmBox(){$("#overlay").show();document.getElementById("confirmBack").setAttribute("style","margin-left:-125px")}function cancelConfirm(){$("#overlay").hide();document.getElementById("confirmBack").setAttribute("style","margin-left:-9999px")}function okConfirm(){readFileNames("home");$("#overlay").hide();document.getElementById("confirmBack").setAttribute("style","margin-left:-9999px")}function openLinkInBrowser(a){decodedLink=$("<div />").html(a).text();navigator.app.loadUrl(decodedLink,{openExternal:true})};